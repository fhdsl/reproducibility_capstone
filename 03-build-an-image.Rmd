# Assignment 1: Building Your Capstone Dockerfile


```{r, out.width = "100%", fig.alt = "This course will demonstrate how to:Recap Docker image building techniques Create an original Docker image ", echo = FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1ExTZsKDHKM0fIi0_tB80qd8cHvqjEDyNJp-OsnvZ19o/edit?slide=id.g361b9572af4_0_181#slide=id.g361b9572af4_0_181")
```

## Phase 1: Repository Setup and Planning

### Step 1: Set Up Your Working Environment

Navigate to your capstone sandbox repository. Locate the `docker/Dockerfile` - this is where you'll be working

**Important: Don't change the name or location of this file.**

### Step 2: Switch to Your Working Branch (if needed)

Verify that you're on the branch you created during the set up instructions. The example used the name `assignment-1-dockerfile`.

#### Option 1: Command Line Method

```bash
git status

# The first line of the output of this command will report what branch you are on...
# On branch assignment-1-dockerfile
```

If you are not on the branch you expect to be on, you can "checkout" or "switch" your branch.

#### Option 2: GitHub Desktop Method

Check the "Current Branch" Dropdown on the top left of the screen. Use the menu to select the branch if you are not on the branch you expect to be on.

### Step 3: Analyze Your Capstone Project Needs

In general, you may already have a reason for building a custom docker image, or a specific set of tools you wish to package together. The following questions and guidelines are helpful for real-world development of a custom docker image.  

_Here are some situations you might find yourself in where a docker image is helpful_:
- You are building a Github action and need a specialized group of packages.
- You are building an analysis that you need a collaborator to run.
- You are building software you want to be reliable in its deployment.

_Questions to ask yourself_:
- What programming languages you're using (R, Python, etc.)
- What packages/libraries your analysis scripts require
- What types of security concerns does this project have?
- Are there publicly available docker images that could cover your needs already?

For this capstone project specifically, you will create a custom docker image with very little guidance as to what packages it will include. Think about a couple of packages that are helpful in your day to day work, and build a docker image with that in mind.

## Phase 2: Dockerfile Development

### Step 4: Examine the Base Setup
- Open `ASSIGNMENT_1/docker/Dockerfile`
- Look on [Docker Hub](https://hub.docker.com/) for what base image best suits your needs -- what's the smallest image you can get away with that is from a verified source?
- Understand what's already included in the base image already. If you're not sure what's already included, consider [inspecting the image with Docker Desktop](https://docs.docker.com/desktop/use-desktop/images/#inspect-an-image)
  - You don't need to add a package that's already there.
  - Will it work with R or Python packages or both?
- Once you've chosen a base image, add it to your Dockerfile.

### Step 5: Add Packages Incrementally
- Start by adding just one or two additional packages to your Dockerfile
- Use the templates from the course:
  - For R packages: `RUN Rscript -e "install.packages('packagename')"`
  - For Python packages: `RUN pip3 install packagename`
- Add comments explaining what each package does

### Step 6: Build Locally

If developing locally (e.g., working through Command Line or GitHub Desktop, rather than on [github.com](https://github.com/) directly), test your Dockerfile with:

```bash
cd ASSIGNMENT_1/docker
docker build . -t my-capstone-image
```

Iterate fixing any build errors and re-building before pushing to GitHub. This saves time and GitHub Actions usage.

```{r out.width = "100%", echo = FALSE, fig.alt = "This table contains common Docker issues you might encounter while building your docker image locally"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1ExTZsKDHKM0fIi0_tB80qd8cHvqjEDyNJp-OsnvZ19o/edit?slide=id.g361b9572af4_0_0#slide=id.g361b9572af4_0_0")
```

If you're not developing locally, opening a pull request with changes to your Dockerfile on GitHub should trigger an evaluation action as explained in the next phase.

## Phase 3: Testing and Iteration

### Step 7: Open Your Pull Request

- Commit your Dockerfile changes to your branch
- Push the branch to GitHub
- Open a pull request from your branch to the main branch
- Changes to the `ASSIGNMENT_1/docker/Dockerfile` triggers the `Docker Assignment Eval` test. Can you guess why?

```{r out.width = "100%", echo = FALSE, fig.alt = "Ruby wants to know if her analysis is reproducibly so she sets up an automation tool to re-run her analysis whenever she pushes changes to her analysis. This robot has a computer for a body and says ‘I will re-run Ruby’s analysis consistently and instantly upon whatever trigger she sets up.’"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1ExTZsKDHKM0fIi0_tB80qd8cHvqjEDyNJp-OsnvZ19o/edit?slide=id.g361b9572af4_0_196#slide=id.g361b9572af4_0_196")
```

### Step 8: Monitor the Automated Testing & Interpret the Results

- On github.com, within your pull request, watch for the `Docker Assignment Eval` check to start running
- This GitHub Action will attempt to build your Dockerfile
- Wait for it to complete. It will comment on your PR whether it successfully built or not.
  - Success: You'll get a validation code in the comment
  - Failure: You'll get error messages explaining what went wrong. Read the error messages carefully - they contain clues for fixing issues
- If the test's comment provides a validation code, skip to Phase 5.
- If the test's comment contains error messages, visit Phase 4: Troubleshooting and Refinement of these instructions.

## Phase 4: Troubleshooting and Refinement

### Step 9: Debug Build Failures

Common issues to check:
  - Typos in package names
  - Missing dependencies (install system packages before language packages). Google or an LLM trained in coding can be helpful for determining this.
  - Incorrect syntax in RUN commands
  - Base image doesn't support your installation method

### Step 10: Iterate Until Success

- Make changes to your Dockerfile on your branch
- Commit and push changes
- Each push will trigger a new test run
- Keep refining until you get a successful build!

```{r out.width="100%", echo = FALSE, fig.alt = "You may have to troubleshoot iteratively until your dockerfile builds successfully. Git commit and push edits to your dockerfile and check your existing pull request to receive evaluation from automated assignment checks. Interpret the results. If you were not successful, troubleshoot and iterate this process as needed, checking your pre-existing pull request for new evaluation results after making additional changes. Or if you were successful in your assignment, submit the verification code to your coursera quiz (or move on to the next section if you are not using coursera or some certification method to take this course)"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1ExTZsKDHKM0fIi0_tB80qd8cHvqjEDyNJp-OsnvZ19o/edit?slide=id.g368818bb4f3_0_417#slide=id.g368818bb4f3_0_417")
```

## Phase 5: Completion

### Step 11: Collect Your Validation Code

- Once your build succeeds, copy the validation code from the PR comment
- Important: Make sure it's a real validation code, not an error message
- Keep this code safe - you'll need it for your quiz

### Step 12: Submit Your Quiz

- Go to your Coursera Capstone Quiz
- Paste the validation code when prompted
- Submit the quiz to get credit for your work

## Suggestions for Troubleshooting and Best Practices

### Start Simple

- Begin with just the most essential packages for your analysis
- You can always add more in subsequent iterations
- A working simple image is better than a broken complex one
- Reference tips from the [Containers for Scientists course](https://hutchdatascience.org/Containers_for_Scientists/) as needed.

### Leverage the Automated Testing

- The GitHub Action is your friend - it provides immediate feedback
- Don't be afraid to make multiple attempts
- Each failure teaches you something about container building

### Read Error Messages Carefully

- Error messages may contain the exact solution you need to fix your problem
- Look for phrases like "package not found" or "missing dependency"
- Google specific error messages if they're unclear
- Copy and paste the error code and include any relevant context to a code trained LLM (e.g., [Phind](https://www.phind.com/)) for additional help.

### Document Your Process

- Add comments to your Dockerfile explaining your choices
- Comments & documentation help you remember your reasoning if you need to modify it later and may make debugging easier

Remember: This assignment is designed to give you hands-on experience with the container building process. The automated testing system provides immediate feedback, making it easier to learn through iteration rather than getting everything perfect on the first try.
